@{
    ViewData["Title"] = "Inicio";
    var isAuthenticated = User?.Identity?.IsAuthenticated == true;
}

<div class="page-header d-print-none mb-3">
    <div class="row align-items-center">
        <div class="col">
            <div class="page-pretitle">
                SIGECES UTEC
            </div>
            <h2 class="page-title">
                Sistema de gestión de cursos extracurriculares
            </h2>
        </div>
    </div>
</div>

@if (!isAuthenticated)
{
    <div class="alert alert-info">
        Para acceder a los cursos, inicia sesión con tu usuario de SIGECES.
    </div>

    <p>
        <a asp-controller="Account" asp-action="Login" class="btn btn-primary">
            Iniciar sesión
        </a>
    </p>
}
else if (User.IsInRole("Admin"))
{
    <!-- Métricas principales Admin -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Usuarios</div>
                    <div class="h1 mb-1">@ViewBag.TotalUsers</div>
                    <div class="text-muted small">Estudiantes activos: @ViewBag.TotalStudents</div>
                    <div class="text-muted small">Instructores activos: @ViewBag.TotalInstructors</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Cursos</div>
                    <div class="h1 mb-1">@ViewBag.TotalCourses</div>
                    <div class="text-muted small">Activos: @ViewBag.ActiveCourses</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Inscripciones</div>
                    <div class="h1 mb-1">@ViewBag.TotalEnrollments</div>
                    <div class="text-muted small">Completadas: @ViewBag.CompletedEnrollments</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">% Finalización global</div>
                    <div class="h1 mb-1">@ViewBag.GlobalCompletionPercent%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Admin fila 1 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Usuarios por rol (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="admin-users-by-role-chart"></div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por estado (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="admin-enrollments-status-chart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Admin fila 2 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por curso (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="admin-enrollments-per-course-chart"></div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por mes (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="admin-enrollments-by-month-chart"></div>
                </div>
            </div>
        </div>
    </div>

    <h4 class="mb-2">Accesos rápidos</h4>
    <div class="list-group mb-3">
        <a asp-controller="Courses" asp-action="Index" class="list-group-item list-group-item-action">
            Gestionar cursos
        </a>
        <a asp-controller="CourseCategories" asp-action="Index" class="list-group-item list-group-item-action">
            Categorías de cursos
        </a>
        <a asp-controller="Users" asp-action="Index" class="list-group-item list-group-item-action">
            Usuarios
        </a>
        <a asp-controller="AdminReports" asp-action="Index" class="list-group-item list-group-item-action">
            Reportes y exportaciones (CSV)
        </a>
    </div>
}
else if (User.IsInRole("Instructor"))
{
    <h2 class="mb-4">Panel del Instructor</h2>
    <p class="text-muted">Resumen de tus cursos y el avance de tus estudiantes.</p>

    <!-- Métricas principales Instructor -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Mis cursos</div>
                    <div class="h1 mb-1">@ViewBag.MyCoursesCount</div>
                    <div class="text-muted small">Total creados</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Cursos activos</div>
                    <div class="h1 mb-1">@ViewBag.MyActiveCourses</div>
                    <div class="text-muted small">Visibles para estudiantes</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Inscripciones</div>
                    <div class="h1 mb-1">@ViewBag.MyTotalEnrollments</div>
                    <div class="text-muted small">En todos tus cursos</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Finalización global</div>
                    <div class="h1 mb-1">@ViewBag.MyCompletionPercent%</div>
                    <div class="text-muted small">Completados / inscritos</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Instructor fila 1 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por curso (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-enrollments-per-course-chart"></div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por estado (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-enrollments-status-chart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Instructor fila 2 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">% de finalización por curso (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-completion-per-course-chart"></div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por mes (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-enrollments-by-month-chart"></div>
                </div>
            </div>
        </div>
    </div>

    <h4>Acciones rápidas</h4>
    <div class="list-group mb-3">
        <a asp-controller="Courses" asp-action="Index" class="list-group-item list-group-item-action">
            Ver / editar mis cursos
        </a>
        <a asp-controller="InstructorReports" asp-action="Index" class="list-group-item list-group-item-action">
            Reportes de mis cursos (CSV y KPIs)
        </a>
    </div>
}
else if (User.IsInRole("Student"))
{
    <h3 class="mb-3">Panel de estudiante</h3>
    <p class="text-muted">Resumen de tu avance en los cursos extracurriculares.</p>

    <!-- Métricas principales Student -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Cursos inscritos</div>
                    <div class="h1 mb-1">@ViewBag.MyTotalEnrollments_Student</div>
                    <div class="text-muted small">Total de inscripciones</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">En progreso</div>
                    <div class="h1 mb-1">@ViewBag.MyInProgressEnrollments_Student</div>
                    <div class="text-muted small">Cursos activos</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Completados</div>
                    <div class="h1 mb-1">@ViewBag.MyCompletedEnrollments_Student</div>
                    <div class="text-muted small">Cursos finalizados</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Avance en lecciones</div>
                    <div class="h1 mb-1">@ViewBag.MyLessonsCompletionPercent_Student%</div>
                    <div class="text-muted small">
                        @ViewBag.MyCompletedLessons_Student / @ViewBag.MyTotalLessons_Student lecciones
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Student -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Estado de mis cursos (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="student-courses-status-chart"></div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Progreso global de lecciones (demo)</h3>
                </div>
                <div class="card-body">
                    <div id="student-lessons-progress-chart"></div>
                </div>
            </div>
        </div>
    </div>

    <h4>Acciones rápidas</h4>
    <div class="row">
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">Catálogo de cursos</h5>
                    <p class="card-text">
                        Ver todos los cursos disponibles en SIGECES.
                    </p>
                    <a asp-controller="StudentCourses" asp-action="Index" class="btn btn-primary">
                        Ir al catálogo
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">Mis cursos</h5>
                    <p class="card-text">
                        Revisa tus inscripciones activas y cursos en progreso.
                    </p>
                    <a asp-controller="StudentCourses" asp-action="MyCourses" class="btn btn-outline-primary">
                        Ver mis cursos
                    </a>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <p>No se pudo determinar tu rol. Contacta al administrador.</p>
}

@section Scripts {
    <script src="~/js/dashboard-admin.js" asp-append-version="true"></script>
    <script src="~/js/dashboard-instructor.js" asp-append-version="true"></script>
    <script src="~/js/dashboard-student.js" asp-append-version="true"></script>
}
