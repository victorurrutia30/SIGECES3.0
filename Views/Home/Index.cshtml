@{
    ViewData["Title"] = "Inicio";
    var isAuthenticated = User?.Identity?.IsAuthenticated == true;
}

<div class="page-header d-print-none mb-3">
    <div class="row align-items-center">
        <div class="col">
            <div class="page-pretitle">
                SIGECES UTEC
            </div>
            <h2 class="page-title">
                Sistema de gestión de cursos extracurriculares
            </h2>
        </div>
    </div>
</div>

@if (!isAuthenticated)
{
    <div class="row align-items-center mb-4">
        <div class="col-lg-7">
            <h2 class="mb-2">
                Gestiona los cursos extracurriculares de la UTEC desde un solo lugar
            </h2>
            <p class="text-muted">
                SIGECES centraliza la oferta de cursos, facilita la inscripción de estudiantes
                y permite a docentes y coordinación académica dar seguimiento al avance.
            </p>

            <div class="d-flex flex-wrap gap-2 mt-3">
                <a asp-controller="Account" asp-action="Login" class="btn btn-primary">
                    <i class="ti ti-login me-1"></i>
                    Iniciar sesión
                </a>
                <a href="#" class="btn btn-outline-secondary disabled">
                    Demo pública (próximamente)
                </a>
            </div>

            <ul class="list-unstyled mt-4 text-muted">
                <li>• Catálogo único de cursos extracurriculares.</li>
                <li>• Inscripciones controladas por docente o administración.</li>
                <li>• Reportes de avance por estudiante, curso y docente.</li>
            </ul>
        </div>

        <div class="col-lg-5 mt-3 mt-lg-0">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h3 class="card-title mb-3">¿Para quién es SIGECES?</h3>

                    <div class="mb-3 d-flex">
                        <span class="avatar bg-primary-lt me-2">
                            <i class="ti ti-school"></i>
                        </span>
                        <div>
                            <div class="fw-semibold">Estudiantes</div>
                            <div class="text-muted small">
                                Exploran el catálogo, se inscriben y llevan control de sus cursos.
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 d-flex">
                        <span class="avatar bg-green-lt me-2">
                            <i class="ti ti-chalkboard"></i>
                        </span>
                        <div>
                            <div class="fw-semibold">Docentes</div>
                            <div class="text-muted small">
                                Gestionan sus cursos, lecciones y seguimiento del grupo.
                            </div>
                        </div>
                    </div>

                    <div class="d-flex">
                        <span class="avatar bg-yellow-lt me-2">
                            <i class="ti ti-report-analytics"></i>
                        </span>
                        <div>
                            <div class="fw-semibold">Administración</div>
                            <div class="text-muted small">
                                Visualizan indicadores globales y exportan reportes.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else if (User.IsInRole("Admin"))
{
    <!-- Métricas principales Admin -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Usuarios</div>
                    <div class="h1 mb-1">@ViewBag.TotalUsers</div>
                    <div class="text-muted small">Estudiantes activos: @ViewBag.TotalStudents</div>
                    <div class="text-muted small">Instructores activos: @ViewBag.TotalInstructors</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Cursos</div>
                    <div class="h1 mb-1">@ViewBag.TotalCourses</div>
                    <div class="text-muted small">Activos: @ViewBag.ActiveCourses</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Inscripciones</div>
                    <div class="h1 mb-1">@ViewBag.TotalEnrollments</div>
                    <div class="text-muted small">Completadas: @ViewBag.CompletedEnrollments</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">% Finalización global</div>
                    <div class="h1 mb-1">@ViewBag.GlobalCompletionPercent%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Admin fila 1 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Usuarios por rol</h3>
                </div>
                <div class="card-body">
                    <div id="admin-users-by-role-chart"
                         data-series='@Html.Raw(ViewBag.AdminUsersByRoleSeries ?? "[]")'
                         data-labels='@Html.Raw(ViewBag.AdminUsersByRoleLabels ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por estado</h3>
                </div>
                <div class="card-body">
                    <div id="admin-enrollments-status-chart"
                         data-series='@Html.Raw(ViewBag.AdminEnrollmentsStatusSeries ?? "[]")'
                         data-labels='@Html.Raw(ViewBag.AdminEnrollmentsStatusLabels ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Admin fila 2 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por curso</h3>
                </div>
                <div class="card-body">
                    <div id="admin-enrollments-per-course-chart"
                         data-series='@Html.Raw(ViewBag.AdminEnrollmentsPerCourseSeries ?? "[]")'
                         data-categories='@Html.Raw(ViewBag.AdminEnrollmentsPerCourseCategories ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por mes</h3>
                </div>
                <div class="card-body">
                    <div id="admin-enrollments-by-month-chart"
                         data-series='@Html.Raw(ViewBag.AdminEnrollmentsByMonthSeries ?? "[]")'
                         data-categories='@Html.Raw(ViewBag.AdminEnrollmentsByMonthCategories ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h4 class="mb-2">Accesos rápidos</h4>
    <div class="list-group mb-3">
        <a asp-controller="Courses" asp-action="Index" class="list-group-item list-group-item-action">
            Gestionar cursos
        </a>
        <a asp-controller="CourseCategories" asp-action="Index" class="list-group-item list-group-item-action">
            Categorías de cursos
        </a>
        <a asp-controller="Users" asp-action="Index" class="list-group-item list-group-item-action">
            Usuarios
        </a>
        <a asp-controller="AdminReports" asp-action="Index" class="list-group-item list-group-item-action">
            Reportes y exportaciones (CSV)
        </a>
    </div>
}
else if (User.IsInRole("Instructor"))
{
    <h2 class="mb-4">Panel del Instructor</h2>
    <p class="text-muted">Resumen de tus cursos y el avance de tus estudiantes.</p>

    <!-- Métricas principales Instructor -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Mis cursos</div>
                    <div class="h1 mb-1">@ViewBag.MyCoursesCount</div>
                    <div class="text-muted small">Total creados</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Cursos activos</div>
                    <div class="h1 mb-1">@ViewBag.MyActiveCourses</div>
                    <div class="text-muted small">Visibles para estudiantes</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Inscripciones</div>
                    <div class="h1 mb-1">@ViewBag.MyTotalEnrollments</div>
                    <div class="text-muted small">En todos tus cursos</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Finalización global</div>
                    <div class="h1 mb-1">@ViewBag.MyCompletionPercent%</div>
                    <div class="text-muted small">Completados / inscritos</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Instructor fila 1 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por curso</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-enrollments-per-course-chart"
                         data-series='@Html.Raw(ViewBag.InstructorEnrollmentsPerCourseSeries ?? "[]")'
                         data-categories='@Html.Raw(ViewBag.InstructorEnrollmentsPerCourseCategories ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por estado</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-enrollments-status-chart"
                         data-series='@Html.Raw(ViewBag.InstructorEnrollmentsStatusSeries ?? "[]")'
                         data-labels='@Html.Raw(ViewBag.InstructorEnrollmentsStatusLabels ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Instructor fila 2 -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">% de finalización por curso</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-completion-per-course-chart"
                         data-series='@Html.Raw(ViewBag.InstructorCompletionPerCourseSeries ?? "[]")'
                         data-categories='@Html.Raw(ViewBag.InstructorCompletionPerCourseCategories ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Inscripciones por mes</h3>
                </div>
                <div class="card-body">
                    <div id="instructor-enrollments-by-month-chart"
                         data-series='@Html.Raw(ViewBag.InstructorEnrollmentsByMonthSeries ?? "[]")'
                         data-categories='@Html.Raw(ViewBag.InstructorEnrollmentsByMonthCategories ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h4>Acciones rápidas</h4>
    <div class="list-group mb-3">
        <a asp-controller="Courses" asp-action="Index" class="list-group-item list-group-item-action">
            Ver / editar mis cursos
        </a>
        <a asp-controller="InstructorReports" asp-action="Index" class="list-group-item list-group-item-action">
            Reportes de mis cursos (CSV y KPIs)
        </a>
    </div>
}
else if (User.IsInRole("Student"))
{
    <h3 class="mb-3">Panel de estudiante</h3>
    <p class="text-muted">Resumen de tu avance en los cursos extracurriculares.</p>

    <!-- Métricas principales Student -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Cursos inscritos</div>
                    <div class="h1 mb-1">@ViewBag.MyTotalEnrollments_Student</div>
                    <div class="text-muted small">Total de inscripciones</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">En progreso</div>
                    <div class="h1 mb-1">@ViewBag.MyInProgressEnrollments_Student</div>
                    <div class="text-muted small">Cursos activos</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Completados</div>
                    <div class="h1 mb-1">@ViewBag.MyCompletedEnrollments_Student</div>
                    <div class="text-muted small">Cursos finalizados</div>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card h-100">
                <div class="card-body text-center">
                    <div class="text-muted mb-1">Avance en lecciones</div>
                    <div class="h1 mb-1">@ViewBag.MyLessonsCompletionPercent_Student%</div>
                    <div class="text-muted small">
                        @ViewBag.MyCompletedLessons_Student / @ViewBag.MyTotalLessons_Student lecciones
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Student -->
    <div class="row mb-4">
        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Estado de mis cursos</h3>
                </div>
                <div class="card-body">
                    <div id="student-courses-status-chart"
                         data-series='@Html.Raw(ViewBag.StudentCoursesStatusSeries ?? "[]")'
                         data-labels='@Html.Raw(ViewBag.StudentCoursesStatusLabels ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-6 mb-3">
            <div class="card h-100">
                <div class="card-header">
                    <h3 class="card-title">Progreso global de lecciones</h3>
                </div>
                <div class="card-body">
                    <div id="student-lessons-progress-chart"
                         data-series='@Html.Raw(ViewBag.StudentLessonsProgressSeries ?? "[]")'>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h4>Acciones rápidas</h4>
    <div class="row">
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">Catálogo de cursos</h5>
                    <p class="card-text">
                        Ver todos los cursos disponibles en SIGECES.
                    </p>
                    <a asp-controller="StudentCourses" asp-action="Index" class="btn btn-primary">
                        Ir al catálogo
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-6 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title">Mis cursos</h5>
                    <p class="card-text">
                        Revisa tus inscripciones activas y cursos en progreso.
                    </p>
                    <a asp-controller="StudentCourses" asp-action="MyCourses" class="btn btn-outline-primary">
                        Ver mis cursos
                    </a>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <p>No se pudo determinar tu rol. Contacta al administrador.</p>
}

@section Scripts {
    <script src="~/js/dashboard-admin.js" asp-append-version="true"></script>
    <script src="~/js/dashboard-instructor.js" asp-append-version="true"></script>
    <script src="~/js/dashboard-student.js" asp-append-version="true"></script>
}
